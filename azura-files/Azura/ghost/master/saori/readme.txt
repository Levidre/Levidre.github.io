	「伺か」用SAORIシステム　　「WMOVE」			 phase 1.06
									02/08/09



１．はじめに

　「WMOVE」は『伺か』用SHIORIシステムのプラグインであるSAORIシステム規格のモジュールです。伺か表示キャラのウィンドウハンドル若しくは名前（「さくら」「うにゅう」等）を受け取る事で、\0キャラ及び\1キャラの立ち位置を変更したり、立ち位置を検出する事が出来ます。



２．出来る事

・移動距離を指定した移動
・同上（ただしデスクトップ外に出ない）
・移動先の位置を指定した移動
・同上（ただしデスクトップ外に出ない）
・（実験中）最前面・最後面への移動（何か上手く動かない時がある）
・整列（重なりの除去等に使用）
・整列（ただしデスクトップ外に出ない）
・移動終了等をMATERIA本体に通知
・立ち位置検出
・デスクトップサイズ取得

　動かしてみれば、大体分かると思います。


３．使い方

３−１．準備

　まず、「wmove.dll」をSAORIとして動作出来る環境に置いて下さい。この環境は
使用するSHIORIシステムによって異なるので、そちらの説明を参照して下さい。
同じく、３−２以降で説明する動作指定方法もSHIORIシステムにより異なるので、
そちらの説明を参照して下さい。

　ただし、『「WMOVE」は寿命をSHIORIシステムと合わせて下さい。』
（別スレッドを使用してウィンドウ移動を行なっているので、アンロードされると
　ウィンドウ移動が出来なくなってしまいます）



３−２．動作指定（基本）

　SAORIシステムはSAORIモジュールに引き数を渡す事で動作指定を行ないます。
「WMOVE」の場合、以下の通りに引き数を指定する事で動作させる事が出来ます。


・移動距離を指定した移動
	第１引き数‥‥‥‥‥「MOVE」という文字列
	第２引き数‥‥‥‥‥動かしたいキャラのウィンドウハンドル値
				 or
			    動かしたいキャラの名前
	第３引き数‥‥‥‥‥動かす距離（負の数で左、正の数で右に動きます）
	第４引き数‥‥‥‥‥速度


・同上（ただしデスクトップ外に出ない）
	第１引き数‥‥‥‥‥「MOVE_INSIDE」という文字列
	第２引き数‥‥‥‥‥動かしたいキャラのウィンドウハンドル値
				 or
			    動かしたいキャラの名前
	第３引き数‥‥‥‥‥動かす距離（負の数で左、正の数で右に動きます）
	第４引き数‥‥‥‥‥速度


・移動先の位置を指定した移動
	第１引き数‥‥‥‥‥「MOVETO」という文字列
	第２引き数‥‥‥‥‥動かしたいキャラのウィンドウハンドル値
				 or
			    動かしたいキャラの名前
	第３引き数‥‥‥‥‥移動先のＸ座標（左端が０）
	第４引き数‥‥‥‥‥速度


・同上（ただしデスクトップ外に出ない）
	第１引き数‥‥‥‥‥「MOVETO_INSIDE」という文字列
	第２引き数‥‥‥‥‥動かしたいキャラのウィンドウハンドル値
				 or
			    動かしたいキャラの名前
	第３引き数‥‥‥‥‥移動先のＸ座標（左端が０）
	第４引き数‥‥‥‥‥速度


・（実験中）最前面・最後面への移動（何か上手く動かない時がある）
	第１引き数‥‥‥‥‥「ZMOVE」という文字列
	第２引き数‥‥‥‥‥\0キャラのウィンドウハンドル値
				 or
			    \0キャラの名前
				（\0,\1の個別移動は出来ません）
	第３引き数‥‥‥‥‥最前面・最後面のどちらに移動するか
				1=最前面
				2=最後面


・整列
	第１引き数‥‥‥‥‥「STANDBY」という文字列
	第２引き数‥‥‥‥‥左側に立つキャラのウィンドウハンドル値
				 or
			    左側に立つキャラの名前
	第３引き数‥‥‥‥‥右側に立つキャラのウィンドウハンドル値
				 or
			    右側に立つキャラの名前
	第４引き数‥‥‥‥‥両者の距離（負の数で重なり方向）
	第５引き数‥‥‥‥‥どちらが移動するかの指定
				1=左側のキャラが移動します
				2=右側のキャラが移動します
				3=両方のキャラが移動します
	第６引き数‥‥‥‥‥速度


・整列（ただしデスクトップ外に出ない）
	第１引き数‥‥‥‥‥「STANDBY_INSIDE」という文字列
	第２引き数‥‥‥‥‥左側に立つキャラのウィンドウハンドル値
				 or
			    左側に立つキャラの名前
	第３引き数‥‥‥‥‥右側に立つキャラのウィンドウハンドル値
				 or
			    右側に立つキャラの名前
	第４引き数‥‥‥‥‥両者の距離（負の数で重なり方向）
	第５引き数‥‥‥‥‥どちらが移動するかの指定
				1=左側のキャラが移動します
				2=右側のキャラが移動します
				3=両方のキャラが移動します
	第６引き数‥‥‥‥‥速度


・立ち位置検出
	第１引き数‥‥‥‥‥「GET_POSITION」という文字列
	第２引き数‥‥‥‥‥位置を知りたいキャラのウィンドウハンドル値
				 or
			    位置を知りたいキャラの名前

	返り値		Result‥‥‥該当キャラの左端のＸ座標
			Value0‥‥‥該当キャラの左端のＸ座標
			Value1‥‥‥該当キャラの中心のＸ座標
			Value2‥‥‥該当キャラの右端のＸ座標


・デスクトップサイズ取得
	第１引き数‥‥‥‥‥「GET_DESKTOP_SIZE」という文字列

	返り値		Result‥‥‥デスクトップの幅
			Value0‥‥‥デスクトップの幅
			Value1‥‥‥デスクトップの高さ



３−３．動作指定（拡張）

　ウィンドウハンドルを一つしか取らない移動方法（MOVE,MOVE_INSIDE,MOVETO,
MOVETO_INSIDE,ZMOVE）は、移動指定を積み上げる事が出来ます。つまり、
ある動作が終わらないウチに次の動作・次の動作を次々に指定して行く事が
出来ます。この指定は２０段まで積み上げが可能です。
　また、この積み上げはウィンドウハンドル毎に行なわれます。
別のウィンドウハンドルへの指定は別の積み上げになりますので、
同時に２キャラを動かす事も可能です。

　この積み上げには、以下の操作が追加して指定可能になっています。

・一定時間停止
	第１引き数‥‥‥‥‥「WAIT」という文字列
	第２引き数‥‥‥‥‥対象キャラのウィンドウハンドル値
				 or
			    対象キャラの名前
	第３引き数‥‥‥‥‥停止時間（ミリ秒単位で指定。1000ミリ秒=1秒）


・MATERIA本体に通知
　（MATERIA本体にDirectSSTP発行。本体経由でSHIORIに情報を渡せます）
	第１引き数‥‥‥‥‥「NOTIFY」という文字列
	第２引き数‥‥‥‥‥対象キャラのウィンドウハンドル値
				 or
			    対象キャラの名前
	第３引き数‥‥‥‥‥ユーザー任意のイベント名（「OnWmoveStop」等）
	第４〜７引き数‥‥‥上記イベントに付加する情報（Reference0〜3）


・積み上げの破棄（＝現在移動しているキャラの停止）
	第１引き数‥‥‥‥‥「CLEAR」という文字列
	第２引き数‥‥‥‥‥対象キャラのウィンドウハンドル値
				 or
			    対象キャラの名前


　注意事項が一つあります。ウィンドウハンドルを二つ使用する整列
（STANDBY,STANDBY_INSIDE）は、積み上げ破棄の効果を持ちます。つまり、
MOVE等の移動をしている最中にSTANDBY等を実行した場合、MOVE以降の積み上げは
全て破棄され、STANDBY実行が終了した時点で移動は終了となります。



３−４．動作指定（その他）

　動作・位置取得対象の指定方法として名前を使用する場合、自分以外の
ゴーストも対象にする事が可能です。ただし、同一名称のsakura、keroキャラが
同時に存在した場合、対象は不定となります。
（ウィンドウハンドル値による指定の場合は、この現象は発生しません）



４．履歴

・2002/04/26 phase1.00
	ese-shiori phase3.05のシステム変数追加に伴い、実験用SAORIを作成。
	そのまま機能追加して公開。

・2002/05/07 phase1.01
	ウィンドウハンドル値指定以外に、キャラ名指定方式も可能とした。
	本体が生きている限りスレッドが殺されずに延々増え続けるバグを修正。
	「整列」動作の引き数の順序が間違っていたのを修正。

・2002/05/10 phase1.01b
	「文」等で動作しない問題を修正。

・2002/05/14 phase1.02
	「MOVETO」処理が丸々欠落していたので修正（←間抜け過ぎ）。
	ＳＳＰ仮対応。
	（\1キャラが動かせるようになりました。が、３体目以降は動かせません）

・2002/06/04 phase1.03
	「伺か」本体のOnDesktopChange廃止に伴い、デスクトップサイズ取得追加。

・2002/06/11 phase1.04
	DirectSSTP発行機能を追加。同梱していたソースを分離。

・2002/07/05 phase1.05
	ウィンドウ移動ＡＰＩの使用方法を変更。

・2002/08/09 phase1.06
	CROW対応（hwnd取得方法変更、移動とNOTIFYの使用hwnd分離）。
	DirectSSTP使用時のバグを修正。


５．最後に

　使用して、何か重大なことが起こっても製作者はその責務を一切負いません。
自己責任の元、適度な使用をオススメします。が、何か不具合等があった場合は
下記の場所にて対応します。

-----------------------------------------------------------------------
http://www.globetown.net/~tmizu/ese.html

wmove.dll phase 1.06                                Copyright (C) tmizu
-----------------------------------------------------------------------
